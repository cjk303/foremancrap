<VirtualHost *:80>
    ServerName foreman.epiqcorp.com

    # Forwarded protocol header from nginx
    RequestHeader set X-Forwarded-Proto "https"

    # OIDC configuration
    OIDCProviderMetadataURL https://login.microsoftonline.com/<TENANT_ID>/v2.0/.well-known/openid-configuration
    OIDCClientID <APP_ID>
    OIDCClientSecret <SECRET_VALUE>
    OIDCRedirectURI https://foreman.epiqcorp.com/users/extlogin/redirect_uri
    OIDCCryptoPassphrase some_random_string

    # Protect the login callback
    <Location /users/extlogin>
        AuthType openid-connect
        Require valid-user
    </Location>

    # Everything else is handled by Passenger/Rails
</VirtualHost>
